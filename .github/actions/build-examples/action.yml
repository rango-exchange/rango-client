name: 'Build Examples'
description: 'Links the current widget embedded package to example projects and builds them'

runs:
  using: 'composite'
  steps:
    - name: ğŸ”¨ Build Widget Package
      run: yarn run build:widget
      shell: bash

    - name: ğŸ”— Link Core Packages
      run: |
        echo "::group::ğŸ”— Creating symbolic links for widget and React dependencies"
        yarn link --cwd widget/embedded
        yarn link --cwd node_modules/react
        yarn link --cwd node_modules/react-dom
        echo "âœ… Packages linked successfully"
        echo "::endgroup::"
      shell: bash

    - name: ğŸ“¦ Setup Example Projects
      run: |
        echo "::group::ğŸ” Scanning and configuring example projects"
        for dir in ./examples/*; do
          if [ -f "$dir/package.json" ]; then
            echo ""
            echo "ğŸ“‚ Processing: $dir"
            echo "  ğŸ”— Linking @rango-dev/widget-embedded..."
            yarn --cwd $dir link @rango-dev/widget-embedded
            yarn --cwd $dir link react
            yarn --cwd $dir link react-dom
            echo "  ğŸ“¥ Installing dependencies..."
            yarn --cwd $dir
            echo "  âœ… Setup complete for $dir"
          fi
        done
        echo ""
        echo "ğŸ‰ All example projects configured successfully"
        echo "::endgroup::"
      shell: bash

    - name: âš™ï¸ Configure Vite Build Settings
      run: |
        echo "::group::âš™ï¸ Updating Vite configurations"
        cp -rf scripts/build-examples/vite.config.ts examples/vite
        cp -rf scripts/build-examples/vite.vue.config.ts examples/vue/vite.config.ts
        echo "  ğŸ“¦ Adding vite-plugin-node-polyfills to Vite example..."
        yarn --cwd examples/vite add -D vite-plugin-node-polyfills@0.17.0
        echo "  ğŸ“¦ Adding vite-plugin-node-polyfills to Vue example..."
        yarn --cwd examples/vue add -D vite-plugin-node-polyfills@0.17.0
        echo "âœ… Vite configurations updated"
        echo "::endgroup::"
      shell: bash

    - name: ğŸš€ Build All Examples
      run: |
        echo "::group::ğŸš€ Building all example projects"
        for dir in ./examples/*; do
          if [ -f "$dir/package.json" ]; then
            echo ""
            echo "ğŸ—ï¸ Building: $dir"
            yarn --cwd $dir build
            echo "âœ… Build complete: $dir"
          fi
        done
        echo ""
        echo "ğŸŠ All examples built successfully!"
        echo "::endgroup::"
      shell: bash